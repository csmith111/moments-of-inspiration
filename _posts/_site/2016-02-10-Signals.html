<p>Reactive programs require us to write programs that respond to a stream of “events”. Additionally, making these programs composable allows us to use all our functional programming techniques to manipulate makes these programs - <strong>Functional Reactive Programming (FRP)</strong>.</p>

<p>The first concept that is needs is how do we represent a stream of events? Just like <code class="highlighter-rouge">List a</code> represent an extensible structure containing elements of type a, we introduce <code class="highlighter-rouge">Signal a</code> which contains an extensible structure which contains the type a.</p>

<p><strong>In some sense there is a relationship/duality between extensible structures (Lists) in space (memory) and Streams of events (Signals) that are extensible structures in time.</strong></p>

<p><strong>A Signal is a special type that represents a set of values changing over time</strong> <code class="highlighter-rouge">type Signal a</code>.The coordinates representing the location of the mouse (Mouse.position) and the keys pressed on the keyboard are examples of Signals.</p>

<p>Our Reactive programs contain “networks” of such signals that we process using some special functions that can process Signals.
Here are the some key functions (defined in the <a href="http://package.elm-lang.org/packages/elm-lang/core/3.0.0/Signal">Signal Module</a>):</p>

<ul>
  <li>Map
    <ul>
      <li><code class="highlighter-rouge">map : (a -&gt; b) -&gt; Signal a -&gt; Signal b</code></li>
    </ul>
  </li>
  <li>Merge
    <ul>
      <li><code class="highlighter-rouge">merge : Signal a -&gt; Signal a -&gt; Signal a</code></li>
    </ul>
  </li>
  <li>Manage state:
    <ul>
      <li><code class="highlighter-rouge">foldp : (a -&gt; s -&gt; s) -&gt; s -&gt; Signal a -&gt; Signal s</code></li>
    </ul>
  </li>
  <li>Filter
    <ul>
      <li><code class="highlighter-rouge">filter : (a -&gt; Bool) -&gt; a -&gt; Signal a -&gt; Signal a</code></li>
    </ul>
  </li>
</ul>

<p>Understanding how to use all these functions and getting familiar with some standard Signals like the mouse position (<code class="highlighter-rouge">Mouse.position : Signal (Int, Int)</code>)  and keyboard presses (<code class="highlighter-rouge">Keyboard.presses : Signal KeyCode</code>) should take us a long way towards a clear understanding of <strong>FRP</strong>.</p>

<h3 id="mouse-signals">Mouse Signals</h3>

<figure class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span class="kr">import</span> <span class="nn">Graphics.Element</span> <span class="n">exposing</span> <span class="p">(</span><span class="o">..</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Mouse</span>

<span class="n">main</span> <span class="o">:</span> <span class="kt">Signal</span> <span class="kt">Element</span>
<span class="n">main</span> <span class="o">=</span>
  <span class="kt">Signal</span><span class="o">.</span><span class="n">map</span> <span class="n">show</span> <span class="kt">Mouse</span><span class="o">.</span><span class="n">position</span></code></pre></figure>

<p>Try this out by pasting this code in the <a href="http://elm-lang.org/try">online editor/runner.</a></p>

<p>Let us see if we can understand this code. Mouse.position is a Signal that contains a tuple of Integers which are the mouse coordinates, we want to <code class="highlighter-rouge">show</code> each of these tuples.
Just like we can use the function map for lists:
<code class="highlighter-rouge">map : (a -&gt; b) -&gt; List a -&gt; List b</code>, the Signal module defines a map function that maps a function over a Signal: <code class="highlighter-rouge">map : (a -&gt; b) -&gt; Signal a -&gt; Signal b</code>.</p>

<p>So that is all we need to do map show over the Mouse position Signal using Signal.map! (Amazing how close the code in the program is to this description in the text.)</p>

<p>Now let us look at how to write a simple function that operates on two values  and map it over two Signals.</p>

<figure class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span class="kr">import</span> <span class="nn">Mouse</span>
<span class="kr">import</span> <span class="nn">Signal</span> <span class="n">exposing</span> <span class="p">(</span><span class="n">map2</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Graphics.Element</span> <span class="n">exposing</span> <span class="p">(</span><span class="kt">Element</span><span class="p">,</span> <span class="n">show</span><span class="p">)</span>

<span class="n">combine</span> <span class="n">x</span> <span class="n">y</span> <span class="o">=</span> <span class="n">show</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="n">main</span> <span class="o">:</span> <span class="kt">Signal</span> <span class="kt">Element</span>
<span class="n">main</span> <span class="o">=</span>
  <span class="n">map2</span> <span class="n">combine</span> <span class="kt">Mouse</span><span class="o">.</span><span class="n">x</span> <span class="kt">Mouse</span><span class="o">.</span><span class="n">y</span></code></pre></figure>

<p>This should give you a clear picture of how we can take normal functions like <code class="highlighter-rouge">combine</code> that we can define and <strong>lift/map</strong> them over Signals.</p>

<h3 id="keyboard-signals">Keyboard Signals</h3>
<p>Now let us look at some programs that manipulate Keyboard events.</p>

<p>Here we will display the Signals generated form the 4 arrow keys.</p>

<figure class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span class="kr">import</span> <span class="nn">Keyboard</span>
<span class="kr">import</span> <span class="nn">Signal</span>
<span class="kr">import</span> <span class="nn">Graphics.Element</span> <span class="n">exposing</span> <span class="p">(</span><span class="n">show</span><span class="p">)</span>

<span class="n">main</span> <span class="o">=</span> <span class="kt">Signal</span><span class="o">.</span><span class="n">map</span> <span class="n">show</span> <span class="kt">Keyboard</span><span class="o">.</span><span class="n">arrows</span></code></pre></figure>

<p>Another simple program that manages the keyboard signals from the standards keys.</p>

<figure class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span class="kr">import</span> <span class="nn">Keyboard</span>
<span class="kr">import</span> <span class="nn">Signal</span>
<span class="kr">import</span> <span class="nn">Graphics.Element</span> <span class="n">exposing</span> <span class="p">(</span><span class="n">show</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Char</span> <span class="n">exposing</span> <span class="p">(</span><span class="o">..</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">String</span> <span class="n">exposing</span> <span class="p">(</span><span class="o">..</span><span class="p">)</span>


<span class="n">main</span> <span class="o">=</span> <span class="kt">Signal</span><span class="o">.</span><span class="n">map</span> <span class="n">show</span> <span class="p">(</span><span class="kt">Signal</span><span class="o">.</span><span class="n">map</span> <span class="n">fromCode</span> <span class="kt">Keyboard</span><span class="o">.</span><span class="n">presses</span><span class="p">)</span></code></pre></figure>

<p>Easy enough, and I think that we can see a pattern emerging of how we write programs to process Signals.</p>

<h3 id="managing-state">Managing state</h3>

<p>Now that we are familiar with managing Signals, we can look at how do we manage state. So far we just dealt with events as they arise and routed them through our programs. So we did not have and acton that depended on the previous state of a Signal.</p>

<p>If for example, we want to create a program to count the mouse clicks that have happened so far, then we need to keep a running count of the clicks that have happened. Then increment this count every time a new click happens.</p>

<p>To functional programers they have already encountered a similar problem with lists.
Foe example, How do you sum the elements for a list? You have to take an initial value for the sum and then increment this value as we process each element in the list. This is done using a function fold. We covered an example of this in the post on <a href="https://csmith111.github.io/jekyll/update/2016/02/07/ASecondBlogPost.html">Elm basics</a>.</p>

<p>There is a function similar to fold that works for signals called <strong>foldp</strong> (for fold over the past?)
Looking at the signature:</p>

<p><code class="highlighter-rouge">foldp : (a -&gt; s -&gt; s) -&gt; s -&gt; Signal a -&gt; Signal s</code></p>

<p>we see that <code class="highlighter-rouge">foldp</code> takes a function and a <code class="highlighter-rouge">initial state</code>  and updates this initial state  every time an event happens.
This idea becomes one of the main pattern in functional reactive pograms for managing state.</p>

<p>Okay here is a simple program that illustrates this.</p>

<figure class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span class="kr">module</span> <span class="nn">MouseSignals1</span> <span class="kr">where</span>
<span class="kr">import</span> <span class="nn">Mouse</span>
<span class="kr">import</span> <span class="nn">Signal</span> <span class="n">exposing</span> <span class="p">(</span><span class="n">map</span><span class="p">,</span> <span class="n">foldp</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Graphics.Element</span> <span class="n">exposing</span> <span class="p">(</span><span class="o">..</span>  <span class="p">)</span>

<span class="n">clickCounter</span> <span class="o">:</span> <span class="kt">Int</span>
<span class="n">clickCounter</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1">-- increment uses only the counter but we need two arguments as we are going to fold over the counter and the signal.</span>
<span class="n">increment</span><span class="o">:</span> <span class="n">a</span><span class="o">-&gt;</span> <span class="kt">Int</span> <span class="o">-&gt;</span> <span class="kt">Int</span>
<span class="n">increment</span> <span class="n">something</span> <span class="n">counter</span> <span class="o">=</span> <span class="n">counter</span><span class="o">+</span><span class="mi">1</span>

<span class="n">main</span> <span class="o">:</span> <span class="kt">Signal</span> <span class="kt">Element</span>
<span class="n">main</span> <span class="o">=</span> <span class="n">map</span> <span class="n">show</span> <span class="p">(</span><span class="n">foldp</span> <span class="n">increment</span> <span class="n">clickCounter</span> <span class="p">(</span><span class="kt">Mouse</span><span class="o">.</span><span class="n">clicks</span><span class="p">))</span></code></pre></figure>

<p>This code is a bit verbose because I explicitly created a counter and the <code class="highlighter-rouge">increment</code> function. Shown below is the code that more experienced functional programmers will write.
Note that in this example increment uses only the counter value and just increments it. We are not look at the state of the Signal, we just need to know that it happened in this example. We do need two arguments as we are going to fold over the counter and the signal.
In other examples we will use the values stored in the signal.</p>

<figure class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span class="kr">module</span> <span class="nn">MouseSignals1</span> <span class="kr">where</span>
<span class="kr">import</span> <span class="nn">Mouse</span>
<span class="kr">import</span> <span class="nn">Signal</span> <span class="n">exposing</span> <span class="p">(</span><span class="n">map</span><span class="p">,</span> <span class="n">foldp</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Graphics.Element</span> <span class="n">exposing</span> <span class="p">(</span><span class="n">show</span><span class="p">)</span>

<span class="n">main</span> <span class="o">=</span> <span class="n">map</span> <span class="n">show</span> <span class="p">(</span><span class="n">foldp</span> <span class="p">(</span><span class="nf">\</span><span class="kr">_</span> <span class="n">n</span> <span class="o">-&gt;</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="mi">0</span> <span class="p">(</span><span class="kt">Mouse</span><span class="o">.</span><span class="n">clicks</span><span class="p">))</span></code></pre></figure>

<p>Like most good functional programs this one is mesmerizing in its conciseness and simplicity!</p>

<h3 id="exercises">Exercises</h3>

<ul>
  <li>Try and make a counter that counts the number of seconds since the program is launched. Hint: you can use the function <code class="highlighter-rouge">fps : number -&gt; Signal Time</code> which is one of the tickers defined in the module Time. <a href="http://package.elm-lang.org/packages/elm-lang/core/3.0.0/Time#fps">See the documentation here.</a>.</li>
</ul>

<figure class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span class="kr">import</span> <span class="nn">Signal</span> <span class="n">exposing</span> <span class="p">(</span><span class="o">..</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Time</span> <span class="n">exposing</span> <span class="p">(</span><span class="o">..</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Graphics.Element</span> <span class="n">exposing</span> <span class="p">(</span><span class="o">..</span><span class="p">)</span>

<span class="n">main</span> <span class="o">=</span> <span class="n">map</span> <span class="n">show</span> <span class="n">counter</span>

<span class="n">increment</span> <span class="o">=</span> <span class="kt">Time</span><span class="o">.</span><span class="n">fps</span> <span class="mi">1</span>
<span class="n">counter</span> <span class="o">=</span> <span class="kt">Signal</span><span class="o">.</span><span class="n">foldp</span> <span class="p">(</span><span class="nf">\</span><span class="kr">_</span> <span class="n">n</span> <span class="o">-&gt;</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="mi">0</span> <span class="n">increment</span></code></pre></figure>

<ul>
  <li>Write a program that counts the number of key presses.</li>
</ul>

<figure class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span class="kr">import</span> <span class="nn">Keyboard</span>
<span class="kr">import</span> <span class="nn">Signal</span>
<span class="kr">import</span> <span class="nn">Graphics.Element</span> <span class="n">exposing</span> <span class="p">(</span><span class="n">show</span><span class="p">)</span>

<span class="n">main</span> <span class="o">=</span> <span class="kt">Signal</span><span class="o">.</span><span class="n">map</span> <span class="n">show</span> <span class="p">(</span><span class="kt">Signal</span><span class="o">.</span><span class="n">foldp</span> <span class="p">(</span><span class="nf">\</span><span class="kr">_</span> <span class="n">n</span> <span class="o">-&gt;</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="mi">0</span> <span class="kt">Keyboard</span><span class="o">.</span><span class="n">presses</span><span class="p">)</span></code></pre></figure>

<ul>
  <li>Write a program that builds up a string of all the keys that are pressed.</li>
</ul>

<figure class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span class="kr">import</span> <span class="nn">Keyboard</span>
<span class="kr">import</span> <span class="nn">Signal</span>
<span class="kr">import</span> <span class="nn">Graphics.Element</span> <span class="n">exposing</span> <span class="p">(</span><span class="n">show</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Char</span> <span class="n">exposing</span> <span class="p">(</span><span class="o">..</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">String</span> <span class="n">exposing</span> <span class="p">(</span><span class="o">..</span><span class="p">)</span>

<span class="n">main</span> <span class="o">=</span> <span class="kt">Signal</span><span class="o">.</span><span class="n">map</span> <span class="n">show</span> <span class="p">(</span><span class="kt">Signal</span><span class="o">.</span><span class="n">foldp</span> <span class="p">(</span><span class="nf">\</span><span class="n">keyStr</span> <span class="n">s</span> <span class="o">-&gt;</span> <span class="n">s</span><span class="o">++</span> <span class="p">(</span><span class="n">fromChar</span>  <span class="n">keyStr</span><span class="p">))</span> <span class="s">""</span> <span class="p">(</span><span class="kt">Signal</span><span class="o">.</span><span class="n">map</span> <span class="n">fromCode</span> <span class="kt">Keyboard</span><span class="o">.</span><span class="n">presses</span><span class="p">))</span></code></pre></figure>

<ul>
  <li>Write a simple clock program that displays the current time.
The code below is not very pretty,  add a background and style the display to make a pretty clock.</li>
</ul>

<figure class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span class="kr">import</span> <span class="nn">Signal</span> <span class="n">exposing</span> <span class="p">(</span><span class="n">map</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Graphics.Element</span> <span class="n">exposing</span> <span class="p">(</span><span class="n">show</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Time</span>
<span class="kr">import</span> <span class="nn">Date</span> <span class="n">exposing</span> <span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">hour</span><span class="p">,</span> <span class="n">minute</span><span class="p">,</span> <span class="n">second</span><span class="p">,</span> <span class="n">fromTime</span><span class="p">)</span>

<span class="n">main</span> <span class="o">=</span>

  <span class="kt">Signal</span><span class="o">.</span><span class="n">map</span> <span class="n">currentTime</span> <span class="p">(</span><span class="kt">Time</span><span class="o">.</span><span class="n">every</span> <span class="kt">Time</span><span class="o">.</span><span class="n">second</span><span class="p">)</span>

<span class="c1">--construct the time from the time in milliseconds since epoch</span>
<span class="n">currentTime</span> <span class="n">t</span> <span class="o">=</span>
  <span class="kr">let</span> <span class="n">date'</span> <span class="o">=</span> <span class="n">fromTime</span> <span class="n">t</span>
      <span class="n">hour'</span> <span class="o">=</span> <span class="n">toString</span> <span class="p">(</span><span class="kt">Date</span><span class="o">.</span><span class="n">hour</span> <span class="n">date'</span><span class="p">)</span>
      <span class="n">minute'</span> <span class="o">=</span> <span class="n">toString</span> <span class="p">(</span><span class="kt">Date</span><span class="o">.</span><span class="n">minute</span> <span class="n">date'</span><span class="p">)</span>
      <span class="n">second'</span> <span class="o">=</span> <span class="n">toString</span> <span class="p">(</span><span class="kt">Date</span><span class="o">.</span><span class="n">second</span> <span class="n">date'</span><span class="p">)</span>
      <span class="n">year'</span> <span class="o">=</span> <span class="n">toString</span> <span class="p">(</span><span class="n">year</span> <span class="n">date'</span><span class="p">)</span>
      <span class="n">now</span> <span class="o">=</span> <span class="s">"The current time is: "</span> <span class="o">++</span> <span class="n">hour'</span> <span class="o">++</span> <span class="s">":"</span> <span class="o">++</span> <span class="n">minute'</span> <span class="o">++</span> <span class="s">":"</span> <span class="o">++</span> <span class="n">second'</span>
  <span class="kr">in</span>
      <span class="n">show</span> <span class="n">now</span></code></pre></figure>

<ul>
  <li>Can you construct a program that takes the mouse position,runs it through two different functions offSetPosition and relativePosition and then displays both results.
(This exercise was suggested to me by <a href="https://twitter.com/ainvvy?ref_src=twsrc%5Egoogle%7Ctwcamp%5Eserp%7Ctwgr%5Eauthor">Vinay</a>, and it really illustrates how difficult it is to work with Signals until you have mastered the Signal idioms.)</li>
</ul>

<figure class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span class="kr">import</span> <span class="nn">Graphics.Element</span> <span class="n">exposing</span> <span class="p">(</span><span class="o">..</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Mouse</span>
<span class="kr">import</span> <span class="nn">Signal</span> <span class="n">exposing</span> <span class="p">(</span><span class="n">map</span><span class="p">,</span> <span class="n">map2</span><span class="p">)</span>

<span class="n">combine</span> <span class="o">:</span> <span class="n">a</span> <span class="o">-&gt;</span> <span class="n">b</span> <span class="o">-&gt;</span> <span class="kt">Element</span>
<span class="n">combine</span> <span class="n">a</span> <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">flow</span> <span class="n">right</span><span class="p">)</span> <span class="p">[</span><span class="n">show</span> <span class="n">a</span><span class="p">,</span> <span class="n">show</span> <span class="n">b</span><span class="p">]</span>

<span class="n">relMousePosition</span> <span class="n">mp</span> <span class="o">=</span> <span class="p">(</span><span class="n">toFloat</span><span class="p">(</span><span class="n">fst</span> <span class="n">mp</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">toFloat</span><span class="p">(</span><span class="n">snd</span> <span class="n">mp</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="n">offsetMousePosition</span>  <span class="n">mp</span> <span class="o">=</span> <span class="p">(</span><span class="n">fst</span> <span class="n">mp</span> <span class="o">+</span><span class="mi">100</span><span class="p">,</span> <span class="n">snd</span> <span class="n">mp</span> <span class="o">+</span><span class="mi">100</span><span class="p">)</span>

<span class="n">main</span> <span class="o">=</span> <span class="n">map2</span> <span class="n">combine</span> <span class="p">(</span><span class="n">map</span> <span class="n">relMousePosition</span> <span class="kt">Mouse</span><span class="o">.</span><span class="n">position</span><span class="p">)</span> <span class="p">(</span><span class="n">map</span> <span class="n">offsetMousePosition</span> <span class="kt">Mouse</span><span class="o">.</span><span class="n">position</span><span class="p">)</span></code></pre></figure>

<p>Or you can use the combine function in the package Signal.Extra which has a few nice additional functions.</p>

<ul>
  <li>Can you display a list of Signals? Use 4 Mouse Signals as an example.</li>
</ul>

<figure class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span class="kr">import</span> <span class="nn">Graphics.Element</span> <span class="n">exposing</span> <span class="p">(</span><span class="n">show</span><span class="p">,</span> <span class="n">down</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">leftAligned</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Mouse</span>
<span class="kr">import</span> <span class="nn">Signal.Extra</span> <span class="n">exposing</span> <span class="p">(</span><span class="n">mapMany</span><span class="p">)</span>

<span class="n">main</span> <span class="o">=</span>  <span class="n">mapMany</span> <span class="p">(</span><span class="n">show</span><span class="p">)</span> <span class="p">[</span><span class="kt">Mouse</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="kt">Mouse</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="kt">Mouse</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="kt">Mouse</span><span class="o">.</span><span class="n">y</span><span class="p">]</span></code></pre></figure>

<p>If you have not already done this before please take a look at this <a href="http://elm-lang.org/guide/reactivity#signals">great article explaining Signals on elm-lang</a>.</p>

<h3 id="mailboxes">Mailboxes</h3>

<p>The next topic to look at is using Mailboxes and Tasks.</p>

<p>Here is a simple example of using a Mailbox to
handle button clicks on a web page.</p>

<figure class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span class="kr">import</span> <span class="nn">Html</span>
<span class="kr">import</span> <span class="nn">Html.Events</span> <span class="k">as</span> <span class="n">Events</span>
<span class="kr">import</span> <span class="nn">Random</span>

<span class="n">view</span> <span class="o">:</span> <span class="kt">Signal</span><span class="o">.</span><span class="kt">Address</span> <span class="kt">String</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="o">-&gt;</span> <span class="kt">Html</span><span class="o">.</span><span class="kt">Html</span>
<span class="n">view</span> <span class="n">address</span> <span class="n">message</span> <span class="o">=</span>
  <span class="kt">Html</span><span class="o">.</span><span class="n">div</span>
    <span class="kt">[]</span>
    <span class="p">[</span> <span class="kt">Html</span><span class="o">.</span><span class="n">button</span>
        <span class="p">[</span> <span class="kt">Events</span><span class="o">.</span><span class="n">onClick</span> <span class="n">address</span> <span class="s">"Welcome To Elm"</span> <span class="p">]</span>
        <span class="p">[</span> <span class="kt">Html</span><span class="o">.</span><span class="n">text</span> <span class="s">"Click Me"</span> <span class="p">]</span>
      <span class="p">,</span><span class="kt">Html</span><span class="o">.</span><span class="n">div</span> <span class="kt">[]</span> <span class="p">[</span> <span class="kt">Html</span><span class="o">.</span><span class="n">text</span> <span class="n">message</span> <span class="p">]</span>
    <span class="p">]</span>

<span class="n">mb</span> <span class="o">:</span> <span class="kt">Signal</span><span class="o">.</span><span class="kt">Mailbox</span> <span class="kt">String</span>
<span class="n">mb</span> <span class="o">=</span>
  <span class="kt">Signal</span><span class="o">.</span><span class="n">mailbox</span> <span class="s">""</span>

<span class="n">main</span> <span class="o">:</span> <span class="kt">Signal</span> <span class="kt">Html</span><span class="o">.</span><span class="kt">Html</span>
<span class="n">main</span> <span class="o">=</span>
  <span class="kt">Signal</span><span class="o">.</span><span class="n">map</span> <span class="p">(</span><span class="n">view</span> <span class="n">mb</span><span class="o">.</span><span class="n">address</span><span class="p">)</span> <span class="n">mb</span><span class="o">.</span><span class="n">signal</span></code></pre></figure>

<h3 id="exercise">Exercise</h3>

<ul>
  <li>Can you extend the previous message to two buttons that display different messages in the same text field?</li>
</ul>

<figure class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span class="kr">import</span> <span class="nn">Html</span>
<span class="kr">import</span> <span class="nn">Html.Events</span> <span class="k">as</span> <span class="n">Events</span>
<span class="kr">import</span> <span class="nn">String</span>

<span class="n">view</span> <span class="o">:</span> <span class="kt">Signal</span><span class="o">.</span><span class="kt">Address</span> <span class="kt">String</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="o">-&gt;</span> <span class="kt">Html</span><span class="o">.</span><span class="kt">Html</span>
<span class="n">view</span> <span class="n">address</span> <span class="n">message</span> <span class="o">=</span>
  <span class="kt">Html</span><span class="o">.</span><span class="n">div</span>
    <span class="kt">[]</span>
    <span class="p">[</span> <span class="kt">Html</span><span class="o">.</span><span class="n">button</span>
        <span class="p">[</span> <span class="kt">Events</span><span class="o">.</span><span class="n">onClick</span> <span class="n">address</span> <span class="s">"Welcome To Elm"</span> <span class="p">]</span>
        <span class="p">[</span> <span class="kt">Html</span><span class="o">.</span><span class="n">text</span> <span class="s">"Click Me"</span> <span class="p">]</span>

      <span class="p">,</span><span class="kt">Html</span><span class="o">.</span><span class="n">button</span>
        <span class="p">[</span> <span class="kt">Events</span><span class="o">.</span><span class="n">onClick</span> <span class="n">address</span> <span class="p">(</span><span class="kt">String</span><span class="o">.</span><span class="n">reverse</span> <span class="s">"Elm Welcomes you"</span><span class="p">)</span> <span class="p">]</span>
        <span class="p">[</span> <span class="kt">Html</span><span class="o">.</span><span class="n">text</span> <span class="s">"Click Me 2"</span> <span class="p">]</span>
      <span class="p">,</span><span class="kt">Html</span><span class="o">.</span><span class="n">div</span> <span class="kt">[]</span> <span class="p">[</span> <span class="kt">Html</span><span class="o">.</span><span class="n">text</span> <span class="n">message</span> <span class="p">]</span>      
    <span class="p">]</span>

<span class="n">mb</span> <span class="o">:</span> <span class="kt">Signal</span><span class="o">.</span><span class="kt">Mailbox</span> <span class="kt">String</span>
<span class="n">mb</span> <span class="o">=</span>
  <span class="kt">Signal</span><span class="o">.</span><span class="n">mailbox</span> <span class="s">""</span>

<span class="n">main</span> <span class="o">:</span> <span class="kt">Signal</span> <span class="kt">Html</span><span class="o">.</span><span class="kt">Html</span>
<span class="n">main</span> <span class="o">=</span>
  <span class="kt">Signal</span><span class="o">.</span><span class="n">map</span> <span class="p">(</span><span class="n">view</span> <span class="n">mb</span><span class="o">.</span><span class="n">address</span><span class="p">)</span> <span class="n">mb</span><span class="o">.</span><span class="n">signal</span></code></pre></figure>

<ul>
  <li>Can you update two different fields when two buttons are clicked?</li>
</ul>

<figure class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span class="kr">import</span> <span class="nn">Html</span>
<span class="kr">import</span> <span class="nn">Html.Events</span> <span class="k">as</span> <span class="n">Events</span>
<span class="kr">import</span> <span class="nn">String</span>

<span class="c1">-- define the model for the view</span>
<span class="kr">type</span> <span class="n">alias</span> <span class="kt">Model</span> <span class="o">=</span> <span class="p">{</span><span class="n">s1</span><span class="o">:</span><span class="kt">String</span><span class="p">,</span> <span class="n">s2</span><span class="o">:</span><span class="kt">String</span><span class="p">}</span>

<span class="c1">--define the view</span>
<span class="n">view</span> <span class="o">:</span> <span class="kt">Signal</span><span class="o">.</span><span class="kt">Address</span> <span class="kt">Model</span> <span class="o">-&gt;</span> <span class="kt">Model</span> <span class="o">-&gt;</span> <span class="kt">Html</span><span class="o">.</span><span class="kt">Html</span>
<span class="n">view</span> <span class="n">address</span> <span class="n">model</span> <span class="o">=</span>
  <span class="kt">Html</span><span class="o">.</span><span class="n">div</span>
    <span class="kt">[]</span>
    <span class="p">[</span> <span class="kt">Html</span><span class="o">.</span><span class="n">button</span>
        <span class="p">[</span> <span class="kt">Events</span><span class="o">.</span><span class="n">onClick</span> <span class="n">address</span> <span class="p">{</span><span class="n">model</span><span class="o">|</span><span class="n">s1</span><span class="o">=</span><span class="s">"Hi from Button 1"</span><span class="p">,</span> <span class="n">s2</span> <span class="o">=</span><span class="s">"-"</span><span class="p">}</span> <span class="p">]</span>
        <span class="p">[</span> <span class="kt">Html</span><span class="o">.</span><span class="n">text</span> <span class="s">"Click Me"</span> <span class="p">]</span>

      <span class="p">,</span><span class="kt">Html</span><span class="o">.</span><span class="n">button</span>
        <span class="p">[</span> <span class="kt">Events</span><span class="o">.</span><span class="n">onClick</span> <span class="n">address</span> <span class="p">{</span><span class="n">model</span> <span class="o">|</span> <span class="n">s1</span> <span class="o">=</span> <span class="s">"-"</span><span class="p">,</span> <span class="n">s2</span> <span class="o">=</span> <span class="s">"Button2 says Hello"</span><span class="p">}</span> <span class="p">]</span>
        <span class="p">[</span> <span class="kt">Html</span><span class="o">.</span><span class="n">text</span> <span class="s">"Click Me 2"</span> <span class="p">]</span>
      <span class="p">,</span><span class="kt">Html</span><span class="o">.</span><span class="n">div</span> <span class="kt">[]</span> <span class="p">[</span> <span class="kt">Html</span><span class="o">.</span><span class="n">text</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">s1</span><span class="p">)</span> <span class="p">]</span>  
      <span class="p">,</span><span class="kt">Html</span><span class="o">.</span><span class="n">div</span> <span class="kt">[]</span> <span class="p">[</span> <span class="kt">Html</span><span class="o">.</span><span class="n">text</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">s2</span><span class="p">)</span> <span class="p">]</span>
    <span class="p">]</span>

<span class="n">mb</span> <span class="o">:</span> <span class="kt">Signal</span><span class="o">.</span><span class="kt">Mailbox</span> <span class="kt">Model</span>
<span class="n">mb</span> <span class="o">=</span>
  <span class="kt">Signal</span><span class="o">.</span><span class="n">mailbox</span> <span class="p">{</span><span class="n">s1</span><span class="o">=</span><span class="s">""</span><span class="p">,</span> <span class="n">s2</span><span class="o">=</span><span class="s">""</span><span class="p">}</span>

<span class="c1">-- This is the controller that wires up/controls the model and the View</span>
<span class="n">main</span> <span class="o">:</span> <span class="kt">Signal</span> <span class="kt">Html</span><span class="o">.</span><span class="kt">Html</span>
<span class="n">main</span> <span class="o">=</span>
  <span class="kt">Signal</span><span class="o">.</span><span class="n">map</span> <span class="p">(</span><span class="n">view</span> <span class="n">mb</span><span class="o">.</span><span class="n">address</span><span class="p">)</span> <span class="n">mb</span><span class="o">.</span><span class="n">signal</span></code></pre></figure>

<p>Notice how we are very close to the class Model/View controller
pattern here. We will revisit this in more detail when discuss web applications and Web Architecture.</p>

<h3 id="tasks---asynchronous-operations">Tasks - Asynchronous Operations</h3>

<p>The next ingredient that we need is running processes Asynchronously. This is done using Tasks in Elm.</p>

<p><strong>Retrieving data from a web page</strong></p>

<figure class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span class="kr">import</span> <span class="nn">Http</span>
<span class="kr">import</span> <span class="nn">Graphics.Element</span> <span class="n">exposing</span> <span class="p">(</span><span class="o">..</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Html</span> <span class="n">exposing</span> <span class="p">(</span><span class="kt">Html</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Task</span> <span class="n">exposing</span> <span class="p">(</span><span class="kt">Task</span><span class="p">,</span> <span class="n">andThen</span><span class="p">)</span>

<span class="n">main</span> <span class="o">:</span> <span class="kt">Signal</span> <span class="kt">Element</span>
<span class="n">main</span> <span class="o">=</span>
  <span class="kt">Signal</span><span class="o">.</span><span class="n">map</span> <span class="n">show</span> <span class="n">readme</span><span class="o">.</span><span class="n">signal</span>


<span class="c1">-- set up mailbox</span>
<span class="c1">--   the signal is piped directly to main</span>
<span class="c1">--   the address lets us update the signal</span>
<span class="n">readme</span> <span class="o">:</span> <span class="kt">Signal</span><span class="o">.</span><span class="kt">Mailbox</span> <span class="kt">String</span>
<span class="n">readme</span> <span class="o">=</span>
  <span class="kt">Signal</span><span class="o">.</span><span class="n">mailbox</span> <span class="s">""</span>


<span class="c1">-- send some markdown to our readme mailbox</span>
<span class="n">report</span> <span class="o">:</span> <span class="kt">String</span> <span class="o">-&gt;</span> <span class="kt">Task</span> <span class="n">x</span> <span class="nb">()</span>
<span class="n">report</span> <span class="n">markdown</span> <span class="o">=</span>
  <span class="kt">Signal</span><span class="o">.</span><span class="n">send</span> <span class="n">readme</span><span class="o">.</span><span class="n">address</span> <span class="n">markdown</span>


<span class="c1">-- get the readme *and then* send the result to our mailbox</span>
<span class="n">port</span> <span class="n">fetchReadme</span> <span class="o">:</span> <span class="kt">Task</span> <span class="kt">Http</span><span class="o">.</span><span class="kt">Error</span> <span class="nb">()</span>
<span class="n">port</span> <span class="n">fetchReadme</span> <span class="o">=</span>
  <span class="kt">Http</span><span class="o">.</span><span class="n">getString</span> <span class="n">readmeUrl</span> <span class="p">`</span><span class="n">andThen</span><span class="p">`</span> <span class="n">report</span>


<span class="c1">-- the URL of the README.md that we desire</span>
<span class="n">readmeUrl</span> <span class="o">:</span> <span class="kt">String</span>
<span class="n">readmeUrl</span> <span class="o">=</span>
  <span class="s">"https://raw.githubusercontent.com/elm-lang/core/master/README.md"</span></code></pre></figure>

<h3 id="effects">Effects</h3>

<p>One final topic and we are done with processing Signals.</p>

